<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Math Play Library ‚Äì OODLES MATH</title>

  <!-- Kid-friendly fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Baloo+2:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* ===== Kid palette (pastel + bright) ===== */
      --sky:#EAF6FF;
      --mint:#DFFAEF;
      --lemon:#FFF6B7;
      --peach:#FFD6D1;
      --lav:#EDE5FF;

      --card: rgba(255,255,255,.88);
      --card2: rgba(255,255,255,.95);
      --border: rgba(148,163,184,.22);

      --text:#0f172a;
      --muted:#5b6b85;

      --accent:#3B82F6;   /* blue */
      --accent2:#22C55E;  /* green */
      --accent3:#A855F7;  /* purple */
      --accent4:#F59E0B;  /* amber */

      --shadow: 0 18px 45px rgba(15, 23, 42, .12);
      --shadow2: 0 10px 25px rgba(15, 23, 42, .08);

      --radius: 22px;
      --radius2: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Fredoka", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      min-height:100vh;

      background:
        radial-gradient(900px 540px at 10% 10%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(850px 520px at 90% 10%, rgba(168,85,247,.14), transparent 60%),
        radial-gradient(850px 520px at 60% 90%, rgba(34,197,94,.12), transparent 60%),
        linear-gradient(135deg, var(--sky), var(--mint));
    }

    /* Floating bubbles */
    .bg-bubbles{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow:hidden;
      z-index:0;
    }
    .bubble{
      position:absolute;
      width: 18px; height: 18px;
      border-radius: 999px;
      opacity: .35;
      filter: blur(.2px);
      animation: floatUp linear infinite;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.25));
      border: 1px solid rgba(255,255,255,.55);
    }
    @keyframes floatUp{
      from{ transform: translateY(30vh) translateX(0); }
      to{ transform: translateY(-120vh) translateX(20px); }
    }

    /* Subtle dots layer */
    .bg-dots{
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .14;
      background-image: radial-gradient(rgba(15,23,42,.16) 1px, transparent 1px);
      background-size: 18px 18px;
      mix-blend-mode: multiply;
      z-index:0;
    }

    /* ===== Header ===== */
    header{
      position: sticky;
      top:0;
      z-index:20;
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 12px 14px;
    }
    .head-inner{
      max-width: 1240px;
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 280px;
    }
    .brand img{
      height:42px;
      width:42px;
      object-fit: contain;
      filter: drop-shadow(0 10px 14px rgba(15,23,42,.14));
      flex: 0 0 42px;
      animation: pop 1.8s ease-in-out infinite;
    }
    @keyframes pop{
      0%,100%{ transform: translateY(0) rotate(0deg) }
      50%{ transform: translateY(-2px) rotate(-1deg) }
    }
    .brand .t{
      display:flex;
      flex-direction:column;
      line-height:1.1;
    }
    .brand .t b{
      font-family: "Baloo 2", "Fredoka", sans-serif;
      font-size:18px;
      letter-spacing:.2px;
    }
    .brand .t span{
      font-size:12px;
      color:var(--muted);
    }

    .right-hint{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .chip{
      border:1px solid var(--border);
      background: rgba(255,255,255,.82);
      border-radius: 999px;
      padding: 7px 10px;
      font-size:12px;
      color: #0f172a;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .chip .dot{
      width:8px;height:8px;border-radius:99px;
      background: linear-gradient(135deg, rgba(59,130,246,.9), rgba(34,197,94,.9));
      box-shadow: 0 6px 14px rgba(34,197,94,.25);
    }

    /* ===== Layout ===== */
    .wrap{
      max-width: 1240px;
      margin: 0 auto;
      padding: 16px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 16px;
      min-height: calc(100vh - 70px);
      position: relative;
      z-index: 1;
    }

    /* ===== Sidebar ===== */
    .sidebar{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 560px;
    }
    .side-top{
      padding: 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.55);
    }

    .search-wrap{
      position:relative;
    }
    .search{
      width:100%;
      border: 2px solid rgba(148,163,184,.28);
      border-radius: 16px;
      padding: 11px 12px 11px 38px;
      font-size: 14px;
      outline:none;
      background: rgba(255,255,255,.92);
      transition: .15s ease;
    }
    .search:focus{
      border-color: rgba(59,130,246,.45);
      box-shadow: 0 10px 22px rgba(59,130,246,.12);
    }
    .search-ico{
      position:absolute;
      left:12px; top:50%;
      transform: translateY(-50%);
      font-size: 16px;
      opacity:.75;
    }

    .side-meta{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .mini{
      font-size:12px;
      color: var(--muted);
    }

    .pill{
      border:1px solid rgba(148,163,184,.25);
      background: linear-gradient(135deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      border-radius: 999px;
      padding: 7px 10px;
      font-size:12px;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 20px rgba(15,23,42,.08);
      user-select:none;
    }

    .list{
      padding: 12px;
      overflow:auto;
      height: 100%;
      scroll-behavior:smooth;
    }

    /* Cute group header */
    .group{
      margin: 10px 2px 6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .group .name{
      font-size:12px;
      font-weight: 800;
      color:#0f172a;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:8px;
      text-transform: uppercase;
    }
    .badge{
      font-size:11px;
      color: var(--muted);
      border: 1px solid rgba(148,163,184,.26);
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(255,255,255,.72);
    }
    .divider{
      height:1px;
      background: rgba(148,163,184,.20);
      margin: 8px 0 12px;
    }

    /* Lesson cards */
    .item{
      width:100%;
      text-align:left;
      border: 2px solid transparent;
      background: rgba(255,255,255,.86);
      border-radius: 20px;
      padding: 12px 12px;
      cursor:pointer;
      transition: .15s ease;
      margin-bottom: 10px;
      box-shadow: 0 10px 22px rgba(15,23,42,.07);
      position: relative;
      overflow:hidden;
    }
    .item::before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.65;
      background: radial-gradient(450px 120px at 30% 0%, rgba(59,130,246,.12), transparent 60%);
      pointer-events:none;
    }
    .item:hover{
      transform: translateY(-2px);
      border-color: rgba(59,130,246,.30);
      background: rgba(255,255,255,.95);
    }
    .item:active{ transform: translateY(0px) scale(.995); }

    .item.active{
      border-color: rgba(34,197,94,.40);
      box-shadow: 0 14px 28px rgba(34,197,94,.14);
      background: rgba(255,255,255,.96);
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      position:relative;
      z-index:1;
    }
    .ico{
      width:38px;
      height:38px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 12px 18px rgba(15,23,42,.10);
      flex: 0 0 38px;
      font-size: 20px;
      background: linear-gradient(135deg, rgba(255,246,183,.85), rgba(234,246,255,.75));
    }
    .textbox{min-width:0}
    .item .t{
      font-weight: 800;
      font-size: 15px;
      letter-spacing: .15px;
      font-family: "Baloo 2","Fredoka",sans-serif;
    }
    .item .d{
      color: var(--muted);
      font-size: 12px;
      margin-top: 3px;
      font-weight: 500;
    }

    /* Tiny stars (visual only) */
    .stars{
      margin-left:auto;
      display:flex;
      gap:2px;
      opacity:.95;
      font-size: 12px;
      color: #0f172a;
      user-select:none;
    }

    .item.parent{ margin-bottom: 6px; }
    .chev{
      margin-left:8px;
      font-size: 14px;
      color: var(--muted);
      transform: rotate(0deg);
      transition: .15s ease;
      user-select:none;
    }
    .item.parent.expanded .chev{ transform: rotate(180deg); }

    .children{
      margin: 0 0 10px 12px;
      padding-left: 12px;
      border-left: 3px dashed rgba(148,163,184,.30);
      display:none;
    }
    .children.show{ display:block; }
    .child{
      margin-top: 8px;
      border-radius: 18px;
      padding: 11px 11px;
    }
    .child .ico{
      width:34px;height:34px;border-radius: 13px;flex:0 0 34px;font-size:18px;
      background: linear-gradient(135deg, rgba(223,250,239,.9), rgba(234,246,255,.7));
    }

    .side-foot{
      border-top: 1px solid var(--border);
      padding: 10px 12px;
      background: rgba(255,255,255,.55);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .side-foot .small{
      font-size:12px;
      color: var(--muted);
    }

    /* ===== Main ===== */
    .main{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 560px;
      display:flex;
      flex-direction:column;
      position:relative;
    }

    .main-top{
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .now{
      font-weight: 900;
      font-size: 15px;
      font-family: "Baloo 2","Fredoka",sans-serif;
    }
    .url{
      color: var(--muted);
      font-size: 12px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 70ch;
      margin-top:2px;
    }

    .btns{
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      border: 2px solid rgba(148,163,184,.22);
      background: rgba(255,255,255,.9);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      font-weight: 700;
      text-decoration:none;
      color: #0f172a;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 20px rgba(15,23,42,.08);
      transition:.15s;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px) scale(.995); }

    .btn.primary{
      border-color: rgba(59,130,246,.22);
      background: linear-gradient(135deg, rgba(59,130,246,.16), rgba(34,197,94,.14));
    }

    .stage{
      flex:1;
      padding: 14px;
      background:
        radial-gradient(900px 420px at 50% 15%, rgba(255,255,255,.66), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.22), rgba(255,255,255,.10));
    }

    .frame-wrap{
      height:100%;
      background: var(--card2);
      border: 1px solid rgba(148,163,184,.18);
      border-radius: 20px;
      padding: 12px;
      box-shadow: 0 16px 44px rgba(15,23,42,.11);
      position:relative;
      overflow:hidden;
    }

    /* Mascot corner */
    .mascot{
      position:absolute;
      left: 14px;
      bottom: 12px;
      display:flex;
      align-items:flex-end;
      gap:10px;
      pointer-events:none;
      opacity:.95;
    }
    .mascot .face{
      width:54px;height:54px;
      border-radius: 18px;
      display:grid;
      place-items:center;
      font-size:28px;
      background: linear-gradient(135deg, rgba(255,246,183,.95), rgba(223,250,239,.92));
      border: 1px solid rgba(148,163,184,.20);
      box-shadow: 0 16px 26px rgba(15,23,42,.12);
      animation: bob 2.2s ease-in-out infinite;
    }
    @keyframes bob{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-3px); }
    }
    .mascot .bubble{
      position:static;
      width:auto;height:auto;
      border-radius: 16px;
      padding: 9px 12px;
      opacity:1;
      animation:none;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(148,163,184,.18);
      box-shadow: 0 14px 24px rgba(15,23,42,.10);
      font-size: 12px;
      color: var(--muted);
      max-width: 320px;
      line-height:1.25;
    }
    .mascot .bubble b{ color: var(--text); }

    .empty{
      height:100%;
      display:grid;
      place-items:center;
      text-align:center;
      color: var(--muted);
      font-size: 14px;
      padding: 30px;
    }
    .empty b{
      color:#0f172a;
      font-family: "Baloo 2","Fredoka",sans-serif;
      font-size: 18px;
    }
    .empty .sub{
      margin-top:10px;
      font-size:12px;
      line-height:1.35;
    }

    iframe{
      width:100%;
      height: calc(100vh - 70px - 16px - 16px - 54px - 28px - 26px);
      min-height: 540px;
      border:0;
      border-radius: 16px;
      background:#fff;
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .brand .t span{ display:none; }
      iframe{ height: 72vh; min-height: 420px; }
      .mascot{ display:none; } /* keep mobile clean */
    }
  </style>
</head>

<body>
  <!-- Decorative background layers -->
  <div class="bg-bubbles" aria-hidden="true" id="bubbles"></div>
  <div class="bg-dots" aria-hidden="true"></div>

  <header>
    <div class="head-inner">
      <div class="brand">
        <img src="assets/logo-oodles-math.png" alt="OODLES MATH Logo">
        <div class="t">
          <b>Math Play Library</b>
          <span>Tap a game ‚Ä¢ Learn with fun</span>
        </div>
      </div>

      <div class="right-hint">
        <div id="countChip" class="chip"><span class="dot"></span> 0 games</div>
        <div class="chip">‚ú® Tip: Press Ctrl + F5 after updates</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="side-top">
        <div class="search-wrap">
          <span class="search-ico">üîç</span>
          <input id="q" class="search" placeholder="Find a game‚Ä¶ (01, animals, counting, +, -)" />
        </div>

        <div class="side-meta">
          <div id="miniText" class="mini">Type to filter quickly</div>
          <div class="pill">üéÆ Ready to play!</div>
        </div>
      </div>

      <div id="gameList" class="list"></div>

      <div class="side-foot">
        <div class="small">OODLES MATH ‚Ä¢ GitHub Pages</div>
        <!-- ‚úÖ make it visible + English -->
        <a class="btn" href="https://icanread.edu.vn/" target="_blank" rel="noopener">
          üõ†Ô∏è Source
        </a>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="main-top">
        <div>
          <div id="nowTitle" class="now">Pick a game to start</div>
          <div id="nowUrl" class="url"></div>
        </div>

        <div class="btns">
          <a id="openBtn" class="btn primary" href="#" target="_blank" rel="noopener" style="display:none;">‚Üó Open</a>
          <button id="copyBtn" class="btn" style="display:none;">üìã Copy link</button>
        </div>
      </div>

      <div class="stage">
        <div class="frame-wrap">
          <div id="emptyState" class="empty">
            <div>
              <b>üëÜ Choose a lesson on the left</b>
              <div class="sub">
                Some lessons have <b>two games</b> (A / B).<br/>
                Have fun and learn every day üåü
              </div>
            </div>
          </div>

          <iframe id="gameFrame" title="Math Game" style="display:none;"></iframe>

          <!-- Cute mascot helper -->
          <div class="mascot" aria-hidden="true">
            <div class="face">üê∏</div>
            <div class="bubble"><b>Hi!</b> Pick a game and let‚Äôs play math! üéà</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
  // ===== Data =====
  const groups = [
    {
      id: "seeker-b",
      name: "Seeker B",
      icon: "üü¶",
      items: [
        // Semester 1 (Lessons 01‚Äì16)
        { id:"lesson-01", title:"Lesson 01", desc:"Seeker B ‚Ä¢ Lesson 01", icon:"üê∏", url:"lesson-01/" },
        { id:"lesson-02", title:"Lesson 02", desc:"Seeker B ‚Ä¢ Lesson 02", icon:"üêº", url:"lesson-02/" },
        { id:"lesson-03", title:"Lesson 03", desc:"Seeker B ‚Ä¢ Lesson 03", icon:"ü¶ä", url:"lesson-03/" },
        { id:"lesson-04", title:"Lesson 04", desc:"Seeker B ‚Ä¢ Lesson 04", icon:"üçí", url:"lesson-04/" },

        {
          id:"lesson-05",
          title:"Lesson 05",
          desc:"Seeker B ‚Ä¢ Lesson 05 (2 games)",
          icon:"üéØ",
          children: [
            { id:"lesson-05-a", title:"Lesson 05 ‚Äì Game A", desc:"Seeker B ‚Ä¢ Lesson 05", icon:"üÖ∞Ô∏è", url:"lesson-05-game-1/" },
            { id:"lesson-05-b", title:"Lesson 05 ‚Äì Game B", desc:"Seeker B ‚Ä¢ Lesson 05", icon:"üÖ±Ô∏è", url:"lesson-05-game-2/" },
          ]
        },

        { id:"lesson-06", title:"Lesson 06", desc:"Seeker B ‚Ä¢ Lesson 06", icon:"üß©", url:"lesson-06/" },
        { id:"lesson-07", title:"Lesson 07", desc:"Seeker B ‚Ä¢ Lesson 07", icon:"üê±", url:"lesson-07/" },
        { id:"lesson-08", title:"Lesson 08", desc:"Seeker B ‚Ä¢ Lesson 08", icon:"ü¶Å", url:"lesson-08/" },
        { id:"lesson-09", title:"Lesson 09", desc:"Seeker B ‚Ä¢ Lesson 09", icon:"ü¶Ñ", url:"lesson-09/" },
        { id:"lesson-10", title:"Lesson 10", desc:"Seeker B ‚Ä¢ Lesson 10", icon:"üéà", url:"lesson-10/" },
        { id:"lesson-11", title:"Lesson 11", desc:"Seeker B ‚Ä¢ Lesson 11", icon:"üöÄ", url:"lesson-11/" },
        { id:"lesson-12", title:"Lesson 12", desc:"Seeker B ‚Ä¢ Lesson 12", icon:"üçì", url:"lesson-12/" },
        { id:"lesson-13", title:"Lesson 13", desc:"Seeker B ‚Ä¢ Lesson 13", icon:"üçâ", url:"lesson-13/" },
        { id:"lesson-14", title:"Lesson 14", desc:"Seeker B ‚Ä¢ Lesson 14", icon:"üçá", url:"lesson-14/" },

        { id:"lesson-15", title:"Lesson 15 ‚Äì Mid-Module Assessment Revision", desc:"Review (Lessons 01‚Äì14)", icon:"üé≤", url:"lesson-15-review/" },
        { id:"lesson-16", title:"Lesson 16 ‚Äì Mid-Module Assessment Test", desc:"Auto score", icon:"üß†", url:"lesson-16-test/" },

        // Semester 2 (Lessons 17‚Äì31)
        { id:"lesson-17", title:"Lesson 17", desc:"Seeker B ‚Ä¢ Lesson 17", icon:"üêß", url:"lesson-17/" },
        { id:"lesson-18", title:"Lesson 18", desc:"Seeker B ‚Ä¢ Lesson 18", icon:"üê∞", url:"lesson-18/" },
        { id:"lesson-19", title:"Lesson 19", desc:"Seeker B ‚Ä¢ Lesson 19", icon:"üêØ", url:"lesson-19/" },
        { id:"lesson-20", title:"Lesson 20", desc:"Seeker B ‚Ä¢ Lesson 20", icon:"ü¶ã", url:"lesson-20/" },

        {
          id:"lesson-21",
          title:"Lesson 21",
          desc:"Seeker B ‚Ä¢ Lesson 21 (2 games)",
          icon:"üéØ",
          children: [
            { id:"lesson-21-a", title:"Lesson 21 ‚Äì Game A", desc:"Seeker B ‚Ä¢ Lesson 21", icon:"üÖ∞Ô∏è", url:"lesson-21-game-1/" },
            { id:"lesson-21-b", title:"Lesson 21 ‚Äì Game B", desc:"Seeker B ‚Ä¢ Lesson 21", icon:"üÖ±Ô∏è", url:"lesson-21-game-2/" },
          ]
        },

        { id:"lesson-22", title:"Lesson 22", desc:"Seeker B ‚Ä¢ Lesson 22", icon:"ü¶ï", url:"lesson-22/" },
        { id:"lesson-23", title:"Lesson 23", desc:"Seeker B ‚Ä¢ Lesson 23", icon:"üß∏", url:"lesson-23/" },
        {
          id:"lesson-24",
          title:"Lesson 24",
          desc:"Seeker B ‚Ä¢ Lesson 24 (2 games)",
          icon:"üéØ",
          children: [
            { id:"lesson-24-a", title:"Lesson 24 ‚Äì Game A", desc:"Seeker B ‚Ä¢ Lesson 24", icon:"üÖ∞Ô∏è", url:"lesson-24-game-1/" },
            { id:"lesson-24-b", title:"Lesson 24 ‚Äì Game B", desc:"Seeker B ‚Ä¢ Lesson 24", icon:"üÖ±Ô∏è", url:"lesson-24-game-2/" },
          ]
        },
        { id:"lesson-25", title:"Lesson 25", desc:"Seeker B ‚Ä¢ Lesson 25", icon:"üßÅ", url:"lesson-25/" },
        { id:"lesson-26", title:"Lesson 26", desc:"Seeker B ‚Ä¢ Lesson 26", icon:"üç©", url:"lesson-26/" },
        { id:"lesson-27", title:"Lesson 27", desc:"Seeker B ‚Ä¢ Lesson 27", icon:"üßä", url:"lesson-27/" },
        { id:"lesson-28", title:"Lesson 28", desc:"Seeker B ‚Ä¢ Lesson 28", icon:"ü™Å", url:"lesson-28/" },

        {
          id:"lesson-29",
          title:"Lesson 29",
          desc:"Seeker B ‚Ä¢ Lesson 29 (2 games)",
          icon:"üéØ",
          children: [
            { id:"lesson-29-a", title:"Lesson 29 ‚Äì Game A", desc:"Seeker B ‚Ä¢ Lesson 29", icon:"üÖ∞Ô∏è", url:"lesson-29-game-1/" },
            { id:"lesson-29-b", title:"Lesson 29 ‚Äì Game B", desc:"Seeker B ‚Ä¢ Lesson 29", icon:"üÖ±Ô∏è", url:"lesson-29-game-2/" },
          ]
        },

        { id:"lesson-30", title:"Lesson 30 ‚Äì Semester 2 Review", desc:"Review (Lessons 17‚Äì29)", icon:"üéÆ", url:"lesson-30-review/" },
        { id:"lesson-31", title:"Lesson 31 ‚Äì Semester 2 Test", desc:"Auto score", icon:"üèÅ", url:"lesson-31-test/" },
      ]
    },

    { id: "seeker-a", name: "Seeker A", icon: "üü©", items: [] },
    { id: "thinking-math", name: "Thinking Math", icon: "üü™", items: [] }
  ];

  // ===== Elements =====
  const listEl = document.getElementById("gameList");
  const frame = document.getElementById("gameFrame");
  const empty = document.getElementById("emptyState");
  const nowTitle = document.getElementById("nowTitle");
  const nowUrl = document.getElementById("nowUrl");
  const openBtn = document.getElementById("openBtn");
  const copyBtn = document.getElementById("copyBtn");
  const search = document.getElementById("q");
  const countChip = document.getElementById("countChip");
  const miniText = document.getElementById("miniText");

  const base = location.origin + location.pathname.replace(/index\.html$/,"");

  // ===== Helpers =====
  const flatten = () => {
    const out = [];
    groups.forEach(g => {
      g.items.forEach(it => {
        if(it.children){
          it.children.forEach(ch => out.push({ ...ch, group:g.name }));
        } else {
          out.push({ ...it, group:g.name });
        }
      });
    });
    return out;
  };

  const allGames = flatten();
  countChip.innerHTML = `<span class="dot"></span> ${allGames.length} games`;

  function directLink(url){ return base + url; }
  function openLink(gameId){ return base + `?game=${encodeURIComponent(gameId)}`; }

  function setActive(id){
    document.querySelectorAll(".item,.child").forEach(x => x.classList.remove("active"));
    const target = document.querySelector(`[data-id="${id}"]`);
    if(target) target.classList.add("active");
  }

  function ensureParentExpanded(childId){
    const parent = document.querySelector(`[data-child="${childId}"]`);
    if(parent){
      const childrenBox = parent.nextElementSibling;
      if(childrenBox && childrenBox.classList.contains("children")){
        childrenBox.classList.add("show");
        parent.classList.add("expanded");
      }
    }
  }

  function selectGame(game){
    empty.style.display = "none";
    frame.style.display = "block";
    frame.src = game.url;

    nowTitle.textContent = `${game.title}`;
    nowUrl.textContent = directLink(game.url);

    openBtn.style.display = "inline-flex";
    openBtn.href = directLink(game.url);

    copyBtn.style.display = "inline-flex";
    copyBtn.onclick = async () => {
      const link = openLink(game.id);
      try{
        await navigator.clipboard.writeText(link);
        copyBtn.textContent = "‚úÖ Copied!";
        setTimeout(()=>copyBtn.textContent="üìã Copy link", 900);
      }catch(e){
        prompt("Copy this link:", link);
      }
    };

    const u = new URL(location.href);
    u.searchParams.set("game", game.id);
    history.replaceState(null,"",u.toString());

    ensureParentExpanded(game.id);
    setActive(game.id);
  }

  // Simple ‚Äúkid‚Äù star rating (visual only)
  function starsFor(id){
    const n = parseInt((id.match(/\d+/)||["1"])[0],10);
    // easy levels get 1‚Äì2 stars; later get 2‚Äì3 (just for looks)
    const s = n <= 10 ? 1 : (n <= 20 ? 2 : 3);
    return "‚≠ê".repeat(s) + "‚òÜ".repeat(3-s);
  }

  function render(filterText=""){
    const q = filterText.trim().toLowerCase();
    listEl.innerHTML = "";
    let shownCount = 0;

    groups.forEach(group => {
      const items = group.items.filter(it => {
        if(!q) return true;

        if(it.children){
          const parentText = `${it.title} ${it.desc} ${it.id}`.toLowerCase();
          const anyChild = it.children.some(ch =>
            (`${ch.title} ${ch.desc} ${ch.id} ${ch.url}`).toLowerCase().includes(q)
          );
          return parentText.includes(q) || anyChild;
        }

        return (`${it.title} ${it.desc} ${it.id} ${it.url}`).toLowerCase().includes(q);
      });

      if(items.length === 0) return;

      const head = document.createElement("div");
      head.className = "group";
      const totalInGroup = group.items.reduce((acc,it)=> acc + (it.children ? it.children.length : 1), 0);
      head.innerHTML = `
        <div class="name">${group.icon} ${group.name}</div>
        <div class="badge">${totalInGroup} games</div>
      `;
      listEl.appendChild(head);
      listEl.appendChild(Object.assign(document.createElement("div"), { className:"divider" }));

      items.forEach(it => {
        if(it.children){
          const parentBtn = document.createElement("button");
          parentBtn.className = "item parent";
          parentBtn.setAttribute("data-child", it.children[0].id);
          parentBtn.innerHTML = `
            <div class="row">
              <div class="ico">${it.icon || "üìö"}</div>
              <div class="textbox">
                <div class="t">${it.title} <span style="color:var(--muted);font-weight:700">‚Ä¢ Choose A/B</span></div>
                <div class="d">${it.desc}</div>
              </div>
              <div class="stars" aria-hidden="true">${starsFor(it.id)}</div>
              <div class="chev">‚ñæ</div>
            </div>
          `;
          listEl.appendChild(parentBtn);

          const childrenBox = document.createElement("div");
          childrenBox.className = "children";

          it.children.forEach(ch => {
            if(q){
              const txt = (`${ch.title} ${ch.desc} ${ch.id} ${ch.url}`).toLowerCase();
              if(!txt.includes(q)) return;
            }

            const childBtn = document.createElement("button");
            childBtn.className = "item child";
            childBtn.setAttribute("data-id", ch.id);
            childBtn.innerHTML = `
              <div class="row">
                <div class="ico">${ch.icon || "üéÆ"}</div>
                <div class="textbox">
                  <div class="t">${ch.title}</div>
                  <div class="d">${ch.desc}</div>
                </div>
                <div class="stars" aria-hidden="true">${starsFor(ch.id)}</div>
              </div>
            `;
            childBtn.onclick = () => selectGame(ch);
            childrenBox.appendChild(childBtn);
            shownCount++;
          });

          listEl.appendChild(childrenBox);

          parentBtn.onclick = () => {
            const isOpen = childrenBox.classList.contains("show");
            document.querySelectorAll(".children").forEach(box => box.classList.remove("show"));
            document.querySelectorAll(".item.parent").forEach(b => b.classList.remove("expanded"));

            if(!isOpen){
              childrenBox.classList.add("show");
              parentBtn.classList.add("expanded");
            }
          };

        } else {
          const btn = document.createElement("button");
          btn.className = "item";
          btn.setAttribute("data-id", it.id);
          btn.innerHTML = `
            <div class="row">
              <div class="ico">${it.icon || "üéÆ"}</div>
              <div class="textbox">
                <div class="t">${it.title}</div>
                <div class="d">${it.desc}</div>
              </div>
              <div class="stars" aria-hidden="true">${starsFor(it.id)}</div>
            </div>
          `;
          btn.onclick = () => selectGame(it);
          listEl.appendChild(btn);
          shownCount++;
        }
      });
    });

    miniText.textContent = q ? `Showing ${shownCount} results` : "Type to filter quickly";
  }

  // ===== Background bubbles generator =====
  (function makeBubbles(){
    const wrap = document.getElementById("bubbles");
    const count = 18;
    for(let i=0;i<count;i++){
      const b = document.createElement("div");
      b.className = "bubble";
      const size = 10 + Math.random()*22;
      b.style.width = size + "px";
      b.style.height = size + "px";
      b.style.left = (Math.random()*100) + "vw";
      b.style.top = (60 + Math.random()*60) + "vh";
      b.style.animationDuration = (10 + Math.random()*14) + "s";
      b.style.animationDelay = (-Math.random()*10) + "s";
      wrap.appendChild(b);
    }
  })();

  // ===== Events =====
  search.addEventListener("input", () => render(search.value));
  render("");

  // Auto open game from URL param
  const params = new URLSearchParams(location.search);
  const gid = params.get("game");
  if(gid){
    const found = allGames.find(x => x.id === gid);
    if(found){ selectGame(found); }
  }
  </script>
</body>
</html>
